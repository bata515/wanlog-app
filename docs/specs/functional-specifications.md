# 愛犬ブログサイト - 機能仕様書

**プロジェクト名**: my-pet-blog(アプリ名はおしゃれでキャッチーなものにしたいので、別案考えて)
**バージョン**: 1.0.0 (MVP)
**作成日**: 2026-01-01
**対象**: MVP (Minimum Viable Product)

---

## 1. プロジェクト概要

### 1.1 目的

愛犬の日常や成長を記録・共有できるブログサイトを構築する。複数のユーザーが登録し、各自の愛犬について投稿できるコミュニティプラットフォームを提供する。

### 1.2 ターゲットユーザー

- 愛犬家
- 愛犬の成長記録を残したい飼い主
- 他の犬好きと交流したいユーザー

### 1.3 技術要件

- レスポンシブデザイン（PC・タブレット・スマートフォン対応）

---

## 2. 機能一覧

### 2.1 ユーザー認証機能

#### 2.1.1 ユーザー登録

**概要**: 新規ユーザーがアカウントを作成できる

**要件**:

- メールアドレス + パスワードでの登録
- Google OAuth での登録(できれば。必須ではない)
- ユーザー名の設定（必須、重複不可）
- プロフィール画像の設定（任意）

**入力項目**:

- ユーザー名: 3-20 文字、英数字とアンダースコア
- メールアドレス: RFC 5322 準拠
- パスワード: 8 文字以上、英数字記号を含む

**バリデーション**:

- ユーザー名の重複チェック
- メールアドレスの形式チェック・重複チェック
- パスワード強度チェック

**受け入れ条件**:

- [ ] メールアドレスとパスワードで登録できる
- [ ] Google OAuth で登録できる(できれば。必須ではない)
- [ ] バリデーションエラーが適切に表示される
- [ ] 登録後、自動的にログイン状態になる
- [ ] 登録完了後、ダッシュボードへリダイレクトされる

#### 2.1.2 ログイン

**概要**: 既存ユーザーがアカウントにログインできる

**要件**:

- メールアドレス + パスワードでのログイン
- Google OAuth でのログイン
- ログイン状態の保持（セッション管理）

**受け入れ条件**:

- [ ] メールアドレスとパスワードでログインできる
- [ ] Google OAuth でログインできる(できれば。必須ではない)
- [ ] 認証情報が誤っている場合、適切なエラーメッセージが表示される
- [ ] ログイン後、ダッシュボードへリダイレクトされる
- [ ] セッションが保持され、ページ遷移後もログイン状態が維持される

#### 2.1.3 ログアウト

**概要**: ログイン中のユーザーがログアウトできる

**受け入れ条件**:

- [ ] ログアウトボタンをクリックするとログアウトできる
- [ ] ログアウト後、ホームページへリダイレクトされる
- [ ] セッションがクリアされる

#### 2.1.4 プロフィール管理

**概要**: ユーザーが自分のプロフィール情報を編集できる

**編集可能項目**:

- ユーザー名
- プロフィール画像
- 自己紹介文（最大 500 文字）

**受け入れ条件**:

- [ ] プロフィール情報を編集できる
- [ ] プロフィール画像をアップロードできる
- [ ] 変更内容が即座に反映される
- [ ] バリデーションエラーが適切に表示される

---

### 2.2 投稿機能（CRUD）

#### 2.2.1 投稿作成

**概要**: ログインユーザーが愛犬の記録を投稿できる

**要件**:

- タイトル（必須、最大 100 文字）
- 本文（必須、最大 10,000 文字）
- 画像（任意、最大 5 枚）
- タグ（任意、最大 10 個）
- 公開/下書き状態の選択

**受け入れ条件**:

- [ ] タイトルと本文を入力して投稿できる
- [ ] 画像を最大 5 枚までアップロードできる
- [ ] タグを複数選択・作成できる
- [ ] 下書き保存ができる
- [ ] バリデーションエラーが適切に表示される
- [ ] 投稿完了後、投稿詳細ページへリダイレクトされる

#### 2.2.2 投稿一覧表示

**概要**: 公開された投稿を一覧で表示する

**要件**:

- 新着順でソート（デフォルト）
- ページネーション（1 ページ 20 件）
- サムネイル画像の表示（最初の画像）
- タイトル、投稿者、投稿日時、いいね数、コメント数の表示

**受け入れ条件**:

- [ ] 公開投稿が一覧表示される
- [ ] ページネーションが機能する
- [ ] 各投稿カードに必要な情報が表示される
- [ ] 投稿カードをクリックすると詳細ページへ遷移する

#### 2.2.3 投稿詳細表示

**概要**: 投稿の詳細を表示する

**表示内容**:

- タイトル
- 投稿者情報（ユーザー名、プロフィール画像）
- 投稿日時・更新日時
- 本文
- 画像（複数の場合はギャラリー表示）
- タグ一覧
- いいね数・いいねボタン
- コメント一覧・コメント投稿フォーム

**受け入れ条件**:

- [ ] 投稿の全情報が表示される
- [ ] 画像が適切に表示される（複数の場合はスライダーなど）
- [ ] 投稿者の情報が表示される
- [ ] いいね・コメント機能が利用できる

#### 2.2.4 投稿編集

**概要**: 投稿者が自分の投稿を編集できる

**要件**:

- 投稿者本人のみ編集可能
- すべての投稿内容を編集可能
- 既存画像の削除、新規画像の追加

**受け入れ条件**:

- [ ] 投稿者本人のみ編集ボタンが表示される
- [ ] 既存内容が編集フォームに反映される
- [ ] 変更内容を保存できる
- [ ] 画像の追加・削除ができる
- [ ] バリデーションエラーが適切に表示される

#### 2.2.5 投稿削除

**概要**: 投稿者が自分の投稿を削除できる

**要件**:

- 投稿者本人のみ削除可能
- 削除確認ダイアログの表示
- 削除と同時に関連データ（画像、コメント、いいね）も削除

**受け入れ条件**:

- [ ] 投稿者本人のみ削除ボタンが表示される
- [ ] 削除前に確認ダイアログが表示される
- [ ] 削除実行後、投稿一覧ページへリダイレクトされる
- [ ] 関連データも削除される

---

### 2.3 画像アップロード機能

#### 2.3.1 画像アップロード

**概要**: 投稿やプロフィールで画像をアップロードできる

**要件**:

- 対応形式: JPEG, PNG, WebP
- 最大ファイルサイズ: 5MB/枚
- 投稿あたり最大 5 枚
- 画像のリサイズ・最適化（サーバー側）

**受け入れ条件**:

- [ ] 画像ファイルを選択してアップロードできる
- [ ] ドラッグ&ドロップでアップロードできる
- [ ] プレビュー表示される
- [ ] ファイルサイズ・形式のバリデーションが機能する
- [ ] アップロード進捗が表示される
- [ ] エラー時に適切なメッセージが表示される

#### 2.3.2 画像表示

**概要**: アップロードされた画像を適切に表示する

**要件**:

- レスポンシブ対応
- 遅延読み込み（Lazy Loading）
- 複数画像の場合はギャラリー表示
- 画像クリックで拡大表示

**受け入れ条件**:

- [ ] 画像が適切なサイズで表示される
- [ ] 遅延読み込みが機能する
- [ ] ギャラリー表示が機能する
- [ ] 拡大表示モーダルが機能する

---

### 2.4 コメント機能

#### 2.4.1 コメント投稿

**概要**: ログインユーザーが投稿にコメントできる

**要件**:

- コメント本文（必須、最大 500 文字）
- 投稿日時の記録
- 投稿者情報の記録

**受け入れ条件**:

- [ ] ログインユーザーがコメントできる
- [ ] コメント投稿後、即座に表示される
- [ ] バリデーションエラーが適切に表示される
- [ ] 未ログインユーザーにはログイン促進メッセージが表示される

#### 2.4.2 コメント表示

**概要**: 投稿に対するコメントを表示する

**表示内容**:

- コメント本文
- 投稿者情報（ユーザー名、プロフィール画像）
- 投稿日時
- コメント数

**表示順序**: 古い順（投稿日時昇順）

**受け入れ条件**:

- [ ] コメント一覧が表示される
- [ ] 投稿者情報が表示される
- [ ] 投稿日時が適切なフォーマットで表示される

#### 2.4.3 コメント削除

**概要**: コメント投稿者が自分のコメントを削除できる

**要件**:

- コメント投稿者本人のみ削除可能
- 削除確認ダイアログの表示

**受け入れ条件**:

- [ ] コメント投稿者本人のみ削除ボタンが表示される
- [ ] 削除前に確認ダイアログが表示される
- [ ] 削除後、即座にコメントが非表示になる

---

### 2.5 いいね機能

#### 2.5.1 いいね追加

**概要**: ログインユーザーが投稿にいいねできる

**要件**:

- 1 ユーザー 1 投稿につき 1 回のみ
- いいね数のリアルタイム更新
- いいね状態の保存

**受け入れ条件**:

- [ ] ログインユーザーがいいねボタンをクリックできる
- [ ] いいね後、ボタンの表示が変わる（例: ハートが塗りつぶされる）
- [ ] いいね数が増加する
- [ ] ページをリロードしても状態が保持される
- [ ] 未ログインユーザーにはログイン促進メッセージが表示される

#### 2.5.2 いいね削除（取り消し）

**概要**: いいね済みの投稿からいいねを取り消せる

**受け入れ条件**:

- [ ] いいね済みのボタンをクリックすると取り消しできる
- [ ] 取り消し後、ボタンの表示が元に戻る
- [ ] いいね数が減少する
- [ ] ページをリロードしても状態が保持される

---

### 2.6 タグ機能

#### 2.6.1 タグ作成

**概要**: 投稿作成・編集時にタグを作成・選択できる

**要件**:

- タグ名: 1-20 文字
- 投稿あたり最大 5 個
- 既存タグの選択または新規作成

**受け入れ条件**:

- [ ] 既存タグから選択できる
- [ ] 新しいタグを作成できる
- [ ] タグの重複が防止される
- [ ] 最大 5 個の制限が機能する

#### 2.6.2 タグ一覧表示

**概要**: システム内のすべてのタグを一覧表示する

**表示内容**:

- タグ名
- 使用回数（投稿数）

**ソート**: 使用回数降順

**受け入れ条件**:

- [ ] タグ一覧が表示される
- [ ] 使用回数が表示される
- [ ] タグをクリックすると該当投稿一覧へ遷移する

#### 2.6.3 タグ絞り込み

**概要**: タグで投稿を絞り込める

**受け入れ条件**:

- [ ] タグをクリックすると該当投稿のみ表示される
- [ ] 複数タグでの AND 検索ができる
- [ ] 絞り込み状態が URL に反映される

---

### 2.7 検索機能

#### 2.7.1 キーワード検索

**概要**: 投稿をキーワードで検索できる

**検索対象**:

- 投稿タイトル
- 投稿本文
- タグ名

**要件**:

- 部分一致検索
- 検索結果のハイライト表示
- ページネーション

**受け入れ条件**:

- [ ] キーワードで投稿を検索できる
- [ ] 検索結果が一覧表示される
- [ ] マッチした箇所がハイライトされる
- [ ] 検索結果が 0 件の場合、適切なメッセージが表示される

#### 2.7.2 検索結果表示

**概要**: 検索結果を一覧表示する

**表示内容**:

- 検索キーワード
- ヒット件数
- 投稿一覧（投稿一覧表示と同様の形式）

**受け入れ条件**:

- [ ] 検索キーワードが表示される
- [ ] ヒット件数が表示される
- [ ] 検索結果が一覧表示される
- [ ] ページネーションが機能する

---

## 3. 非機能要件

### 3.1 パフォーマンス

- ページ読み込み時間: 3 秒以内（4G 回線）
- 画像最適化による高速表示
- 遅延読み込みの実装

### 3.2 セキュリティ

- パスワードのハッシュ化（bcrypt）
- SQL インジェクション対策（Prisma ORM 使用）
- XSS 対策（入力値のサニタイズ）
- CSRF 対策（NextAuth.js 標準機能）
- HTTPS による通信の暗号化

### 3.3 可用性

- 自動スケーリング
- エラーハンドリングの実装
- ユーザーフレンドリーなエラーメッセージ

### 3.5 アクセシビリティ

- セマンティック HTML
- キーボード操作対応
- スクリーンリーダー対応
- 適切なコントラスト比

---

## 4. 制約事項

### 4.1 MVP 範囲外の機能

以下の機能は MVP には含めず、将来的な実装とする：

- ダイレクトメッセージ機能
- 通知機能
- フォロー/フォロワー機能
- 投稿の共有機能
- 高度な分析・統計機能
- 管理者機能

---

## 5. 想定ユースケース

### 5.1 新規ユーザー登録から投稿まで

1. ユーザーがサイトにアクセス
2. 「新規登録」ボタンをクリック
3. メールアドレスとパスワードを入力して登録
4. ダッシュボードへリダイレクト
5. 「新規投稿」ボタンをクリック
6. タイトル、本文、画像、タグを入力
7. 「投稿する」ボタンをクリック
8. 投稿詳細ページへリダイレクト

### 5.2 他のユーザーの投稿を閲覧・いいね・コメント

1. ログインユーザーが投稿一覧を閲覧
2. 気になる投稿をクリック
3. 投稿詳細を閲覧
4. いいねボタンをクリック
5. コメント欄にコメントを入力
6. 「コメントする」ボタンをクリック
7. コメントが即座に表示される

### 5.3 タグで投稿を検索

1. ユーザーがタグ一覧ページにアクセス
2. 気になるタグ（例: 「シーズー」）をクリック
3. 該当タグの投稿一覧が表示される
4. 投稿を閲覧

---
